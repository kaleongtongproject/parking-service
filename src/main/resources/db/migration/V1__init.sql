CREATE TABLE parking_spot (
    id bigint PRIMARY KEY,
    lot_id bigint NOT NULL,
    spot_number varchar(32) NOT NULL,
    type varchar(32) DEFAULT 'STANDARD'
);


CREATE TABLE parking_session (
    id uuid PRIMARY KEY,
    user_id uuid,
    spot_id bigint,
    checkin_ts timestamptz,
    checkout_ts timestamptz,
    status varchar(32) DEFAULT 'ONGOING',
    pricing_version varchar(64),
    total_amount_cents bigint,
    payment_intent_id varchar(128)
);


CREATE TABLE reservation (
    id uuid PRIMARY KEY,
    user_id uuid,
    spot_id bigint NULL,
    lot_id bigint NOT NULL,
    arrival_ts timestamptz NOT NULL,
    expected_duration_minutes int,
    status varchar(32) NOT NULL,
    price_cents bigint,
    payment_intent_id varchar(128),
    created_at timestamptz DEFAULT now()
);


CREATE TABLE pricing_rule (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name varchar(128),
    json_config jsonb NOT NULL,
    effective_from timestamptz,
    effective_to timestamptz
);

ALTER TABLE parking_session ADD COLUMN license_plate varchar(64);